{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto">
  <!-- Header -->
  <div class="glass-effect rounded-2xl p-6 mb-8 text-center">
    <div class="flex items-center justify-center mb-4">
      <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-4">
        <i class="fas fa-comments text-white text-2xl"></i>
      </div>
      <div>
        <h1 class="text-3xl font-bold text-slate-800 mb-1">Document Assistant</h1>
        <p class="text-slate-600">Let's fill your document together</p>
      </div>
    </div>
    <div class="flex items-center justify-center space-x-2 text-slate-500">
      <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
      <span class="text-sm">AI Assistant is ready</span>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="glass-effect rounded-3xl p-8 mb-6">
    <div id="chat-box" class="space-y-6">
      {% if show_confirmation %}
      <!-- Previous Answer Confirmation -->
      <div class="flex items-start space-x-4 mb-6">
        <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center">
          <i class="fas fa-check text-white"></i>
        </div>
        <div class="flex-1">
          <div class="bg-green-100 border border-green-200 rounded-2xl rounded-bl-sm p-4 shadow-sm">
            <p class="text-green-800">âœ… Got it! Your answer has been saved.</p>
          </div>
        </div>
      </div>
      {% endif %}
      
      <!-- AI Message -->
      <div class="flex items-start space-x-4">
        <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
          <i class="fas fa-robot text-white"></i>
        </div>
        <div class="flex-1">
          <div class="bg-slate-100 rounded-2xl rounded-tl-sm p-6 border border-slate-200 shadow-lg">
            <div class="mb-4">
              <div class="flex items-center justify-between mb-3">
                <span class="text-slate-600 text-sm font-medium">AI Assistant</span>
                <div class="flex space-x-1">
                  <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                  <div class="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
                  <div class="w-2 h-2 bg-pink-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                </div>
              </div>
              <p class="text-slate-800 text-lg leading-relaxed font-medium">{{ question }}</p>
            </div>
            <div class="flex items-center text-slate-500 text-sm">
              <i class="fas fa-lightbulb mr-2"></i>
              <span>Provide the most accurate information possible</span>
            </div>
          </div>
        </div>
      </div>

      <!-- User Input Form -->
      <form hx-post="/fill" hx-target="main" hx-swap="innerHTML" class="flex items-end space-x-4">
        <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center">
          <i class="fas fa-user text-white"></i>
        </div>
        <div class="flex-1">
          <div class="bg-white rounded-2xl rounded-bl-sm p-4 border border-slate-200 shadow-lg">
            <textarea 
              name="answer" 
              placeholder="Type your answer here..." 
              class="w-full bg-transparent text-slate-800 placeholder-slate-500 resize-none focus:outline-none text-lg"
              rows="3"
              required
              onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); this.form.submit(); }"
            ></textarea>
            <input type="hidden" name="index" value="{{ index }}" />
            <div class="flex items-center justify-between mt-4">
              <div class="flex items-center text-slate-500 text-sm">
                <i class="fas fa-info-circle mr-2"></i>
                <span>Press Enter to send, Shift+Enter for new line</span>
              </div>
              <button type="submit" class="btn-primary font-semibold py-3 px-6 rounded-xl flex items-center space-x-2">
                <span>Send</span>
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="glass-effect rounded-2xl p-6">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-slate-800 font-semibold flex items-center">
        <i class="fas fa-tasks mr-2 text-blue-500"></i>
        Progress
      </h3>
      <span class="text-slate-600 text-sm">Question {{ index + 1 }} of {{ total_questions if total_questions else '?' }}</span>
    </div>
    <div class="w-full bg-slate-300 rounded-full h-3">
      {% set progress_width = progress_percentage if progress_percentage else ((index + 1) / total_questions * 100)|round(1) if total_questions else 0 %}
      <div class="progress-bar h-3 rounded-full transition-all duration-500" style="width: {{ progress_width }}%"></div>
    </div>
    {% set progress_text = progress_percentage if progress_percentage else ((index + 1) / total_questions * 100)|round(1) if total_questions else 0 %}
    <p class="text-slate-600 text-sm mt-2">
      {% if total_questions %}
        {{ progress_text }}% complete - Keep going! You're doing great.
      {% else %}
        Keep going! You're doing great.
      {% endif %}
    </p>
  </div>
</div>

<style>
  /* Custom scrollbar */
  .chat-messages::-webkit-scrollbar {
    width: 4px;
  }
  .chat-messages::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
  }
  .chat-messages::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
  }
  .chat-messages::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
  }
</style>

<script>
// Auto-focus on textarea when page loads
document.addEventListener('DOMContentLoaded', function() {
  const textarea = document.querySelector('textarea[name="answer"]');
  if (textarea) {
    textarea.focus();
  }
});

// Form submission handling
document.querySelector('form').addEventListener('submit', function() {
  const button = this.querySelector('button[type="submit"]');
  const span = button.querySelector('span');
  const icon = button.querySelector('i');
  
  span.textContent = 'Sending...';
  icon.className = 'fas fa-spinner animate-spin';
  button.disabled = true;
});
</script>
{% endblock %}
